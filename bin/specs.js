!function(e){function t(o){if(n[o])return n[o].exports;var i=n[o]={exports:{},id:o,loaded:!1};return e[o].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){n(1),n(5),n(6),n(7),n(8),n(9),n(10),n(11),n(12),n(13),e.exports=n(14)},function(e,t,n){"use strict";var o=n(2);describe("a model",function(){var e;it("exists",function(){o.using(e=new o.ClientServerStatesForTesting,function(){expect(e.client).not.toBeNull(),expect(e.server).not.toBeNull()})})})},function(e,t,n){"use strict";function o(e,t){try{t()}finally{e.dispose()}}var i=n(3),r=n(4);t.ActionsClient=r.ActionsAt("client"),t.ActionsServer=r.ActionsAt("server"),t.using=o;var s=function(){function e(){this.client=new i.ClientState("client"),this.server=new i.ClientState("server"),r.getMessagesToSend()}return e.prototype.dispose=function(){r.getMessagesToSend(),this.client.dispose(),this.server.dispose()},e}();t.ClientServerStatesForTesting=s},function(e,t,n){"use strict";var o=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},i=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,s=3>r?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(3>r?i(s):r>3?i(t,n,s):i(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s},r=n(4),s=function(e){function t(){e.apply(this,arguments),this.is_logged_in=!1,this.projects=[]}return o(t,e),t.prototype.login=function(e,t){"client"!==this.tier&&(console.log("login"),"password for "+e===t&&(this.is_logged_in=!0,this.projects=[{guid:"guid_1",name:"project 1",path:"c:/"}],this.current_project_guid))},t.prototype.logout=function(){this.is_logged_in=!1,this.projects=[]},t.prototype.selectProject=function(e){"server"!==this.tier&&(this.current_project_guid=e)},t.prototype.setProjects=function(e){"client"!==this.tier&&(console.log("setProjects"),this.projects=e)},t=i([r.state],t)}(r.TieredState);t.ClientState=s},function(e,t){"use strict";function n(e,t){t=[null].concat(t);var n=e.bind.apply(e,t);return new n}function o(e){var t=e.name;console.log("state: "+t),p.push(e);var o=function(){for(var o=[],i=0;i<arguments.length;i++)o[i-0]=arguments[i];var r=n(e,o);return console.log("instance: "+r.constructor.name),v.push({name:t,instance:r}),new Proxy({},{get:function(e,t){return"dispose"===t?function(){console.log("dispose: "+r.constructor.name);var e=v.length;v=v.filter(function(e){return e.instance!==r}),v.length-e==0&&console.log("disposed 0 from "+JSON.stringify(v)),console.log("disposed "+(e-v.length)),r.dispose&&r.dispose()}:(console.log("getting "+t+" from "+JSON.stringify(r)),r[t])}})};return o.prototype=e.prototype,o}function i(e,t,n,o){void 0===o&&(o=!0),console.log("dispatch: "+t+"("+JSON.stringify(n).slice(1,-1)+")"),o&&c("action",{tier:e,name:t,value:n});var i=v.filter(function(t){return t.instance.tier===e});console.log("looking for instance of action. "+i.length+" total instances of actions");for(var r=0,a=i.filter(function(e){return"function"==typeof e.instance[t]});r<a.length;r++){var l=a[r],u=l.instance;s(u,e,l.name,u[t],n)}}function r(e){var t=JSON.parse(JSON.stringify(e));return delete t.tier,t}function s(e,t,n,o,i){console.log("=> "+n);var s=JSON.stringify(r(e));o.apply(e,i);var a=r(e);if(s!==JSON.stringify(a)){var l=e.version;console.log("new version from "+l),e.version=(l||0)+1,a.version=e.version,console.log("to "+e.version),c("change",{tier:t,store:n,name:"setAll",value:a}),console.log("message: "+JSON.stringify(d[d.length-1]))}}function c(e,t){console.log("queueing message because "+e+": "+JSON.stringify(t)),d.push(t)}function a(e){d.splice(0,d.length);for(var t=function(t){e.filter(function(e){return e[0]===t.name&&e[1]>=(t.instance.version||0)}).length&&c("change (initial)",{tier:t.instance.tier,store:t.name,name:"setAll",value:t.instance})},n=0,o=v;n<o.length;n++){var i=o[n];t(i)}}function l(){return v.map(function(e){return{name:e.name,version:e.instance.version||0}})}function u(e){return new Proxy({},{get:function(t,n){return"toJSON"===n?function(){return"[Proxy]"}:"inspect"===n?function(){return"[Proxyinspect]"}:function(){for(var t=[],o=0;o<arguments.length;o++)t[o-0]=arguments[o];return i(e,n,t)}}})}function g(e){void 0===e&&(e=null),console.log("getMessagesFrom: "+e+" have "+d.length+" queued messages");var t=d.filter(function(t){return null==e||t.tier===e});return d=d.filter(function(t){return null!=e&&t.tier!==e}),t.length?t:null}function f(e,t){console.log("gotMessages at tier "+e+": "+t.length+" messages");for(var n=0,o=t;n<o.length;n++){var r=o[n];if("setAll"===r.name&&r.store){var s=v.filter(function(t){return t.name===r.store&&t.instance.tier===e});for(var c in r.value)if(r.value.hasOwnProperty(c))for(var a=0,l=s;a<l.length;a++){var u=l[a];u.instance[c]=r.value[c]}}else i(e,r.name,r.value,!1)}}var p=[],v=[],d=[];t.state=o,t.dispatch=i,t.messagesFor=a,t.getStoreVersions=l,t.ActionsAt=u,t.getMessagesToSend=g,t.gotMessages=f;var h=function(){function e(e){this.tier=e}return e}();t.TieredState=h},function(e,t,n){"use strict";var o=n(2);describe("a model",function(){var e;it("has default values",function(){o.using(e=new o.ClientServerStatesForTesting,function(){expect(e.client.is_logged_in).toBe(!1),expect(e.client.projects).toEqual([])})})})},function(e,t,n){"use strict";var o=n(2),i=n(4);describe("a model",function(){var e;it("can apply actions from other tiers",function(){o.using(e=new o.ClientServerStatesForTesting,function(){o.ActionsClient.login("a","password for a");var t=i.getMessagesToSend("client");i.gotMessages("server",[t[0]]),expect(e.server.is_logged_in).toBeTruthy()})})})},function(e,t,n){"use strict";var o=n(2),i=n(4);describe("a model",function(){var e;it("can apply changes from other tiers",function(){o.using(e=new o.ClientServerStatesForTesting,function(){o.ActionsServer.login("a","password for a");var t=i.getMessagesToSend("server");console.log(JSON.stringify(t)),i.gotMessages("client",t),expect(e.client.is_logged_in).toBeTruthy()})})})},function(e,t,n){"use strict";var o=n(2);describe("a model",function(){var e;it("can be updated by an action",function(){o.using(e=new o.ClientServerStatesForTesting,function(){o.ActionsServer.setProjects([{name:"p1",guid:"g1",items:[],path:""}]),expect(e.server.projects.length).toBe(1),expect(e.server.projects[0].guid).toBe("g1")})})})},function(e,t,n){"use strict";var o=n(2);describe("a model",function(){var e;it("can execute an action",function(){o.using(e=new o.ClientServerStatesForTesting,function(){o.ActionsClient.login("a","password for a"),o.ActionsServer.login("a","password for a"),expect(e.client.is_logged_in).toBe(!1),expect(e.server.is_logged_in).toBe(!0)})})})},function(e,t,n){"use strict";var o=n(2);describe("a model",function(){var e;it("is not a singleton",function(){o.using(e=new o.ClientServerStatesForTesting,function(){expect(e.client.tier).toBe("client"),expect(e.server.tier).toBe("server")})})})},function(e,t,n){"use strict";var o=n(2);describe("a model",function(){var e;it("is only called for actions of the same tier",function(){o.using(e=new o.ClientServerStatesForTesting,function(){o.ActionsServer.setProjects([{name:"p1",guid:"g1",items:[],path:""}]),expect(e.server.projects.length).toBe(1),expect(e.server.projects[0].guid).toBe("g1"),expect(e.client.projects.length).toBe(0)})})})},function(e,t,n){"use strict";var o=n(2);describe("a model",function(){var e;it("is readonly",function(){o.using(e=new o.ClientServerStatesForTesting,function(){e.client.is_logged_in=!0,expect(e.client.is_logged_in).toBe(!1)})})})},function(e,t,n){"use strict";var o=n(2),i=n(4);describe("a model",function(){var e;it("messages are generated for actions",function(){o.using(e=new o.ClientServerStatesForTesting,function(){o.ActionsClient.login("a","password for a");var e=i.getMessagesToSend("client"),t=e[0];expect(t).toBeTruthy(),expect(t.tier).toBe("client"),expect(t.name).toBe("login"),expect(t.value).toEqual(["a","password for a"])})})})},function(e,t,n){"use strict";var o=n(2),i=n(4);describe("a model",function(){var e;it("messages are generated for changes",function(){o.using(e=new o.ClientServerStatesForTesting,function(){o.ActionsServer.login("a","password for a");var e=i.getMessagesToSend("client");expect(e).toBeNull();var t=i.getMessagesToSend("server"),n=t[1];expect(n).toBeTruthy(),expect(n.tier).toBe("server"),expect(n.name).toBe("setAll"),expect(JSON.stringify(n.value)).toBe(JSON.stringify({is_logged_in:!0,projects:[{guid:"guid_1",name:"project 1",path:"c:/"}],version:1}))})})})}]);