{"version":3,"sources":["webpack:///webpack/bootstrap 8c552dad2e57a8806669","webpack:///modeliv.entry.ts"],"names":[],"mappings":"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","file":"modeliv.entry.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 8c552dad2e57a8806669\n **/","declare class Proxy {\r\n    constructor(object: Object, handler: Object);\r\n}\r\n\r\nconst _states = [] as Function[];\r\ninterface IInstance {\r\n    tier: any;\r\n    version?: number;\r\n};\r\n\r\nlet _instances = [] as { name: string, instance: any }[];\r\n\r\nexport interface Message {\r\n    tier: any;\r\n    name: string;\r\n    value: any;\r\n    store?: any;\r\n}\r\n\r\nlet messages = [] as Message[];\r\n\r\nfunction construct(constructor: Function, args: any[]) {\r\n    args = [null].concat(args);\r\n    const factoryFunction = constructor.bind.apply(constructor, args);\r\n    return new factoryFunction();\r\n}\r\n\r\nexport function state(constructor: Function) {\r\n    const name = (constructor as any).name;\r\n    console.log(\"state: \" + name);\r\n    _states.push(constructor);\r\n\r\n    var new_constructor = ((...args: any[]) => {\r\n        const instance = construct(constructor, args);\r\n        console.log(\"instance: \" + instance.constructor.name);\r\n        _instances.push({ name, instance });\r\n\r\n        return new Proxy({}, {\r\n            get(target: Object, name: string) {\r\n                if (name === \"dispose\")\r\n                    return () => {\r\n                        console.log(\"dispose: \" + instance.constructor.name);\r\n                        var l = _instances.length;\r\n                        _instances = _instances.filter(i => i.instance !== instance);\r\n                        if (_instances.length - l == 0)\r\n                            console.log(\"disposed 0 from \" + JSON.stringify(_instances));\r\n\r\n                        console.log(\"disposed \" + (l - _instances.length));\r\n\r\n                        if (instance.dispose)\r\n                            instance.dispose();\r\n                    };\r\n                console.log(\"getting \" + name + \" from \" + JSON.stringify(instance));\r\n                return instance[name];\r\n            }\r\n        });\r\n    });\r\n    new_constructor.prototype = constructor.prototype;\r\n    return new_constructor as any as void;\r\n}\r\n\r\nexport function dispatch(tier: any, actionName: string, args: any[], propogate = true) {\r\n    console.log(\"dispatch: \" + actionName + \"(\" + JSON.stringify(args).slice(1, -1) + \")\");\r\n\r\n    if (propogate)\r\n        queue(\"action\", { tier, name: actionName, value: args });\r\n\r\n    const instances = _instances.filter(i => i.instance.tier === tier);\r\n    console.log(\"looking for instance of action. \" + instances.length + \" total instances of actions\");\r\n    for (const instance_info of instances.filter(i => typeof i.instance[actionName] === \"function\")) {\r\n        var instance = instance_info.instance;\r\n        dispatchTo(instance, tier, instance_info.name, instance[actionName] as Function, args);\r\n    }\r\n}\r\n\r\nfunction withoutTier(o: Object) {\r\n    const value = JSON.parse(JSON.stringify(o));\r\n    delete value.tier;\r\n    return value;\r\n}\r\n\r\nfunction dispatchTo(instance: IInstance, from_tier: any, name: string, fn: Function, args: any[]) {\r\n    console.log(\"=> \" + name);\r\n    const old = JSON.stringify(withoutTier(instance));\r\n\r\n    fn.apply(instance, args);\r\n\r\n    const value = withoutTier(instance);\r\n\r\n    if (old !== JSON.stringify(value)) {\r\n        let version = instance.version;\r\n        console.log(\"new version from \" + version);\r\n        instance.version = (version || 0) + 1;\r\n        value.version = instance.version;\r\n        console.log(\"to \" + instance.version);\r\n        queue(\"change\", { tier: from_tier, store: name, name: \"setAll\", value });\r\n\r\n        console.log(\"message: \" + JSON.stringify(messages[messages.length - 1]));\r\n    }\r\n}\r\n\r\nfunction queue(reason: string, message: any) {\r\n    console.log(\"queueing message because \" + reason + \": \" + JSON.stringify(message));\r\n    messages.push(message);\r\n}\r\n\r\nexport function messagesFor(sv: any[][]) {\r\n    messages.splice(0, messages.length);\r\n\r\n    for (const instance_info of _instances)\r\n        if (sv.filter(v => v[0] === instance_info.name && v[1] >= (instance_info.instance.version || 0)).length)\r\n            queue(\"change (initial)\", { tier: instance_info.instance.tier, store: instance_info.name, name: \"setAll\", value: instance_info.instance });\r\n}\r\n\r\nexport function getStoreVersions() {\r\n    return _instances.map(instance => ({\r\n        name: instance.name,\r\n        version: instance.instance.version || 0\r\n    }));\r\n}\r\n\r\nexport function ActionsAt(tier: any): any {\r\n    return new Proxy({}, {\r\n        get(target: Object, name: string) {\r\n            if (name === \"toJSON\")\r\n                return () =>\r\n                    \"[Proxy]\";\r\n            if (name === \"inspect\")\r\n                return () =>\r\n                    \"[Proxyinspect]\";\r\n\r\n            return (...args: any[]) =>\r\n                dispatch(tier, name, args);\r\n        }\r\n    });\r\n}\r\n\r\nexport function getMessagesToSend(tier: any = null) {\r\n    console.log(\"getMessagesFrom: \" + tier + \" have \" + messages.length + \" queued messages\");\r\n    const result = messages.filter(m => tier == null || m.tier === tier);\r\n    messages = messages.filter(m => tier != null && m.tier !== tier);\r\n    return result.length ? result : null;\r\n}\r\n\r\nexport function gotMessages(tier: any, messages: Message[]) {\r\n    console.log(\"gotMessages at tier \" + tier + \": \" + messages.length + \" messages\");\r\n    for (var m of messages)\r\n        if (m.name === \"setAll\" && m.store) {\r\n            const stores = _instances.filter(i => i.name === m.store && i.instance.tier === tier);\r\n            for (var key in m.value)\r\n                if (m.value.hasOwnProperty(key))\r\n                    for (const store of stores)\r\n                        store.instance[key] = m.value[key];\r\n\r\n        } else\r\n            dispatch(tier, m.name, m.value, false);\r\n}\r\n\r\nexport class TieredState<T> {\r\n    constructor(public tier: T) { }\r\n}\n\n\n/** WEBPACK FOOTER **\n ** modeliv.entry.ts\n **/"],"sourceRoot":""}